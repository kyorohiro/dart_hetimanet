part of delphiniumapp;

class SwfPlayerBuffer {
  static const String playerswf = "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";
  static const String swfobject = "LyohCVNXRk9iamVjdCB2Mi4yIDxodHRwOi8vY29kZS5nb29nbGUuY29tL3Avc3dmb2JqZWN0Lz4gDQoJaXMgcmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlIDxodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocD4gDQoqLw0KDQp2YXIgc3dmb2JqZWN0ID0gZnVuY3Rpb24oKSB7DQoJDQoJdmFyIFVOREVGID0gInVuZGVmaW5lZCIsDQoJCU9CSkVDVCA9ICJvYmplY3QiLA0KCQlTSE9DS1dBVkVfRkxBU0ggPSAiU2hvY2t3YXZlIEZsYXNoIiwNCgkJU0hPQ0tXQVZFX0ZMQVNIX0FYID0gIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoIiwNCgkJRkxBU0hfTUlNRV9UWVBFID0gImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIiwNCgkJRVhQUkVTU19JTlNUQUxMX0lEID0gIlNXRk9iamVjdEV4cHJJbnN0IiwNCgkJT05fUkVBRFlfU1RBVEVfQ0hBTkdFID0gIm9ucmVhZHlzdGF0ZWNoYW5nZSIsDQoJCQ0KCQl3aW4gPSB3aW5kb3csDQoJCWRvYyA9IGRvY3VtZW50LA0KCQluYXYgPSBuYXZpZ2F0b3IsDQoJCQ0KCQlwbHVnaW4gPSBmYWxzZSwNCgkJZG9tTG9hZEZuQXJyID0gW21haW5dLA0KCQlyZWdPYmpBcnIgPSBbXSwNCgkJb2JqSWRBcnIgPSBbXSwNCgkJbGlzdGVuZXJzQXJyID0gW10sDQoJCXN0b3JlZEFsdENvbnRlbnQsDQoJCXN0b3JlZEFsdENvbnRlbnRJZCwNCgkJc3RvcmVkQ2FsbGJhY2tGbiwNCgkJc3RvcmVkQ2FsbGJhY2tPYmosDQoJCWlzRG9tTG9hZGVkID0gZmFsc2UsDQoJCWlzRXhwcmVzc0luc3RhbGxBY3RpdmUgPSBmYWxzZSwNCgkJZHluYW1pY1N0eWxlc2hlZXQsDQoJCWR5bmFtaWNTdHlsZXNoZWV0TWVkaWEsDQoJCWF1dG9IaWRlU2hvdyA9IHRydWUsDQoJDQoJLyogQ2VudHJhbGl6ZWQgZnVuY3Rpb24gZm9yIGJyb3dzZXIgZmVhdHVyZSBkZXRlY3Rpb24NCgkJLSBVc2VyIGFnZW50IHN0cmluZyBkZXRlY3Rpb24gaXMgb25seSB1c2VkIHdoZW4gbm8gZ29vZCBhbHRlcm5hdGl2ZSBpcyBwb3NzaWJsZQ0KCQktIElzIGV4ZWN1dGVkIGRpcmVjdGx5IGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlDQoJKi8JDQoJdWEgPSBmdW5jdGlvbigpIHsNCgkJdmFyIHczY2RvbSA9IHR5cGVvZiBkb2MuZ2V0RWxlbWVudEJ5SWQgIT0gVU5ERUYgJiYgdHlwZW9mIGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPSBVTkRFRiAmJiB0eXBlb2YgZG9jLmNyZWF0ZUVsZW1lbnQgIT0gVU5ERUYsDQoJCQl1ID0gbmF2LnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLA0KCQkJcCA9IG5hdi5wbGF0Zm9ybS50b0xvd2VyQ2FzZSgpLA0KCQkJd2luZG93cyA9IHAgPyAvd2luLy50ZXN0KHApIDogL3dpbi8udGVzdCh1KSwNCgkJCW1hYyA9IHAgPyAvbWFjLy50ZXN0KHApIDogL21hYy8udGVzdCh1KSwNCgkJCXdlYmtpdCA9IC93ZWJraXQvLnRlc3QodSkgPyBwYXJzZUZsb2F0KHUucmVwbGFjZSgvXi4qd2Via2l0XC8oXGQrKFwuXGQrKT8pLiokLywgIiQxIikpIDogZmFsc2UsIC8vIHJldHVybnMgZWl0aGVyIHRoZSB3ZWJraXQgdmVyc2lvbiBvciBmYWxzZSBpZiBub3Qgd2Via2l0DQoJCQlpZSA9ICErIlx2MSIsIC8vIGZlYXR1cmUgZGV0ZWN0aW9uIGJhc2VkIG9uIEFuZHJlYSBHaWFtbWFyY2hpJ3Mgc29sdXRpb246IGh0dHA6Ly93ZWJyZWZsZWN0aW9uLmJsb2dzcG90LmNvbS8yMDA5LzAxLzMyLWJ5dGVzLXRvLWtub3ctaWYteW91ci1icm93c2VyLWlzLWllLmh0bWwNCgkJCXBsYXllclZlcnNpb24gPSBbMCwwLDBdLA0KCQkJZCA9IG51bGw7DQoJCWlmICh0eXBlb2YgbmF2LnBsdWdpbnMgIT0gVU5ERUYgJiYgdHlwZW9mIG5hdi5wbHVnaW5zW1NIT0NLV0FWRV9GTEFTSF0gPT0gT0JKRUNUKSB7DQoJCQlkID0gbmF2LnBsdWdpbnNbU0hPQ0tXQVZFX0ZMQVNIXS5kZXNjcmlwdGlvbjsNCgkJCWlmIChkICYmICEodHlwZW9mIG5hdi5taW1lVHlwZXMgIT0gVU5ERUYgJiYgbmF2Lm1pbWVUeXBlc1tGTEFTSF9NSU1FX1RZUEVdICYmICFuYXYubWltZVR5cGVzW0ZMQVNIX01JTUVfVFlQRV0uZW5hYmxlZFBsdWdpbikpIHsgLy8gbmF2aWdhdG9yLm1pbWVUeXBlc1siYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2giXS5lbmFibGVkUGx1Z2luIGluZGljYXRlcyB3aGV0aGVyIHBsdWctaW5zIGFyZSBlbmFibGVkIG9yIGRpc2FibGVkIGluIFNhZmFyaSAzKw0KCQkJCXBsdWdpbiA9IHRydWU7DQoJCQkJaWUgPSBmYWxzZTsgLy8gY2FzY2FkZWQgZmVhdHVyZSBkZXRlY3Rpb24gZm9yIEludGVybmV0IEV4cGxvcmVyDQoJCQkJZCA9IGQucmVwbGFjZSgvXi4qXHMrKFxTK1xzK1xTKyQpLywgIiQxIik7DQoJCQkJcGxheWVyVmVyc2lvblswXSA9IHBhcnNlSW50KGQucmVwbGFjZSgvXiguKilcLi4qJC8sICIkMSIpLCAxMCk7DQoJCQkJcGxheWVyVmVyc2lvblsxXSA9IHBhcnNlSW50KGQucmVwbGFjZSgvXi4qXC4oLiopXHMuKiQvLCAiJDEiKSwgMTApOw0KCQkJCXBsYXllclZlcnNpb25bMl0gPSAvW2EtekEtWl0vLnRlc3QoZCkgPyBwYXJzZUludChkLnJlcGxhY2UoL14uKlthLXpBLVpdKyguKikkLywgIiQxIiksIDEwKSA6IDA7DQoJCQl9DQoJCX0NCgkJZWxzZSBpZiAodHlwZW9mIHdpbi5BY3RpdmVYT2JqZWN0ICE9IFVOREVGKSB7DQoJCQl0cnkgew0KCQkJCXZhciBhID0gbmV3IEFjdGl2ZVhPYmplY3QoU0hPQ0tXQVZFX0ZMQVNIX0FYKTsNCgkJCQlpZiAoYSkgeyAvLyBhIHdpbGwgcmV0dXJuIG51bGwgd2hlbiBBY3RpdmVYIGlzIGRpc2FibGVkDQoJCQkJCWQgPSBhLkdldFZhcmlhYmxlKCIkdmVyc2lvbiIpOw0KCQkJCQlpZiAoZCkgew0KCQkJCQkJaWUgPSB0cnVlOyAvLyBjYXNjYWRlZCBmZWF0dXJlIGRldGVjdGlvbiBmb3IgSW50ZXJuZXQgRXhwbG9yZXINCgkJCQkJCWQgPSBkLnNwbGl0KCIgIilbMV0uc3BsaXQoIiwiKTsNCgkJCQkJCXBsYXllclZlcnNpb24gPSBbcGFyc2VJbnQoZFswXSwgMTApLCBwYXJzZUludChkWzFdLCAxMCksIHBhcnNlSW50KGRbMl0sIDEwKV07DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCQljYXRjaChlKSB7fQ0KCQl9DQoJCXJldHVybiB7IHczOnczY2RvbSwgcHY6cGxheWVyVmVyc2lvbiwgd2s6d2Via2l0LCBpZTppZSwgd2luOndpbmRvd3MsIG1hYzptYWMgfTsNCgl9KCksDQoJDQoJLyogQ3Jvc3MtYnJvd3NlciBvbkRvbUxvYWQNCgkJLSBXaWxsIGZpcmUgYW4gZXZlbnQgYXMgc29vbiBhcyB0aGUgRE9NIG9mIGEgd2ViIHBhZ2UgaXMgbG9hZGVkDQoJCS0gSW50ZXJuZXQgRXhwbG9yZXIgd29ya2Fyb3VuZCBiYXNlZCBvbiBEaWVnbyBQZXJpbmkncyBzb2x1dGlvbjogaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC8NCgkJLSBSZWd1bGFyIG9ubG9hZCBzZXJ2ZXMgYXMgZmFsbGJhY2sNCgkqLyANCglvbkRvbUxvYWQgPSBmdW5jdGlvbigpIHsNCgkJaWYgKCF1YS53MykgeyByZXR1cm47IH0NCgkJaWYgKCh0eXBlb2YgZG9jLnJlYWR5U3RhdGUgIT0gVU5ERUYgJiYgZG9jLnJlYWR5U3RhdGUgPT0gImNvbXBsZXRlIikgfHwgKHR5cGVvZiBkb2MucmVhZHlTdGF0ZSA9PSBVTkRFRiAmJiAoZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0gfHwgZG9jLmJvZHkpKSkgeyAvLyBmdW5jdGlvbiBpcyBmaXJlZCBhZnRlciBvbmxvYWQsIGUuZy4gd2hlbiBzY3JpcHQgaXMgaW5zZXJ0ZWQgZHluYW1pY2FsbHkgDQoJCQljYWxsRG9tTG9hZEZ1bmN0aW9ucygpOw0KCQl9DQoJCWlmICghaXNEb21Mb2FkZWQpIHsNCgkJCWlmICh0eXBlb2YgZG9jLmFkZEV2ZW50TGlzdGVuZXIgIT0gVU5ERUYpIHsNCgkJCQlkb2MuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGNhbGxEb21Mb2FkRnVuY3Rpb25zLCBmYWxzZSk7DQoJCQl9CQkNCgkJCWlmICh1YS5pZSAmJiB1YS53aW4pIHsNCgkJCQlkb2MuYXR0YWNoRXZlbnQoT05fUkVBRFlfU1RBVEVfQ0hBTkdFLCBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKGRvYy5yZWFkeVN0YXRlID09ICJjb21wbGV0ZSIpIHsNCgkJCQkJCWRvYy5kZXRhY2hFdmVudChPTl9SRUFEWV9TVEFURV9DSEFOR0UsIGFyZ3VtZW50cy5jYWxsZWUpOw0KCQkJCQkJY2FsbERvbUxvYWRGdW5jdGlvbnMoKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJCWlmICh3aW4gPT0gdG9wKSB7IC8vIGlmIG5vdCBpbnNpZGUgYW4gaWZyYW1lDQoJCQkJCShmdW5jdGlvbigpew0KCQkJCQkJaWYgKGlzRG9tTG9hZGVkKSB7IHJldHVybjsgfQ0KCQkJCQkJdHJ5IHsNCgkJCQkJCQlkb2MuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iik7DQoJCQkJCQl9DQoJCQkJCQljYXRjaChlKSB7DQoJCQkJCQkJc2V0VGltZW91dChhcmd1bWVudHMuY2FsbGVlLCAwKTsNCgkJCQkJCQlyZXR1cm47DQoJCQkJCQl9DQoJCQkJCQljYWxsRG9tTG9hZEZ1bmN0aW9ucygpOw0KCQkJCQl9KSgpOw0KCQkJCX0NCgkJCX0NCgkJCWlmICh1YS53aykgew0KCQkJCShmdW5jdGlvbigpew0KCQkJCQlpZiAoaXNEb21Mb2FkZWQpIHsgcmV0dXJuOyB9DQoJCQkJCWlmICghL2xvYWRlZHxjb21wbGV0ZS8udGVzdChkb2MucmVhZHlTdGF0ZSkpIHsNCgkJCQkJCXNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwgMCk7DQoJCQkJCQlyZXR1cm47DQoJCQkJCX0NCgkJCQkJY2FsbERvbUxvYWRGdW5jdGlvbnMoKTsNCgkJCQl9KSgpOw0KCQkJfQ0KCQkJYWRkTG9hZEV2ZW50KGNhbGxEb21Mb2FkRnVuY3Rpb25zKTsNCgkJfQ0KCX0oKTsNCgkNCglmdW5jdGlvbiBjYWxsRG9tTG9hZEZ1bmN0aW9ucygpIHsNCgkJaWYgKGlzRG9tTG9hZGVkKSB7IHJldHVybjsgfQ0KCQl0cnkgeyAvLyB0ZXN0IGlmIHdlIGNhbiByZWFsbHkgYWRkL3JlbW92ZSBlbGVtZW50cyB0by9mcm9tIHRoZSBET007IHdlIGRvbid0IHdhbnQgdG8gZmlyZSBpdCB0b28gZWFybHkNCgkJCXZhciB0ID0gZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0uYXBwZW5kQ2hpbGQoY3JlYXRlRWxlbWVudCgic3BhbiIpKTsNCgkJCXQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KTsNCgkJfQ0KCQljYXRjaCAoZSkgeyByZXR1cm47IH0NCgkJaXNEb21Mb2FkZWQgPSB0cnVlOw0KCQl2YXIgZGwgPSBkb21Mb2FkRm5BcnIubGVuZ3RoOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGRsOyBpKyspIHsNCgkJCWRvbUxvYWRGbkFycltpXSgpOw0KCQl9DQoJfQ0KCQ0KCWZ1bmN0aW9uIGFkZERvbUxvYWRFdmVudChmbikgew0KCQlpZiAoaXNEb21Mb2FkZWQpIHsNCgkJCWZuKCk7DQoJCX0NCgkJZWxzZSB7IA0KCQkJZG9tTG9hZEZuQXJyW2RvbUxvYWRGbkFyci5sZW5ndGhdID0gZm47IC8vIEFycmF5LnB1c2goKSBpcyBvbmx5IGF2YWlsYWJsZSBpbiBJRTUuNSsNCgkJfQ0KCX0NCgkNCgkvKiBDcm9zcy1icm93c2VyIG9ubG9hZA0KCQktIEJhc2VkIG9uIEphbWVzIEVkd2FyZHMnIHNvbHV0aW9uOiBodHRwOi8vYnJvdGhlcmNha2UuY29tL3NpdGUvcmVzb3VyY2VzL3NjcmlwdHMvb25sb2FkLw0KCQktIFdpbGwgZmlyZSBhbiBldmVudCBhcyBzb29uIGFzIGEgd2ViIHBhZ2UgaW5jbHVkaW5nIGFsbCBvZiBpdHMgYXNzZXRzIGFyZSBsb2FkZWQgDQoJICovDQoJZnVuY3Rpb24gYWRkTG9hZEV2ZW50KGZuKSB7DQoJCWlmICh0eXBlb2Ygd2luLmFkZEV2ZW50TGlzdGVuZXIgIT0gVU5ERUYpIHsNCgkJCXdpbi5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZm4sIGZhbHNlKTsNCgkJfQ0KCQllbHNlIGlmICh0eXBlb2YgZG9jLmFkZEV2ZW50TGlzdGVuZXIgIT0gVU5ERUYpIHsNCgkJCWRvYy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgZm4sIGZhbHNlKTsNCgkJfQ0KCQllbHNlIGlmICh0eXBlb2Ygd2luLmF0dGFjaEV2ZW50ICE9IFVOREVGKSB7DQoJCQlhZGRMaXN0ZW5lcih3aW4sICJvbmxvYWQiLCBmbik7DQoJCX0NCgkJZWxzZSBpZiAodHlwZW9mIHdpbi5vbmxvYWQgPT0gImZ1bmN0aW9uIikgew0KCQkJdmFyIGZuT2xkID0gd2luLm9ubG9hZDsNCgkJCXdpbi5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCgkJCQlmbk9sZCgpOw0KCQkJCWZuKCk7DQoJCQl9Ow0KCQl9DQoJCWVsc2Ugew0KCQkJd2luLm9ubG9hZCA9IGZuOw0KCQl9DQoJfQ0KCQ0KCS8qIE1haW4gZnVuY3Rpb24NCgkJLSBXaWxsIHByZWZlcmFibHkgZXhlY3V0ZSBvbkRvbUxvYWQsIG90aGVyd2lzZSBvbmxvYWQgKGFzIGEgZmFsbGJhY2spDQoJKi8NCglmdW5jdGlvbiBtYWluKCkgeyANCgkJaWYgKHBsdWdpbikgew0KCQkJdGVzdFBsYXllclZlcnNpb24oKTsNCgkJfQ0KCQllbHNlIHsNCgkJCW1hdGNoVmVyc2lvbnMoKTsNCgkJfQ0KCX0NCgkNCgkvKiBEZXRlY3QgdGhlIEZsYXNoIFBsYXllciB2ZXJzaW9uIGZvciBub24tSW50ZXJuZXQgRXhwbG9yZXIgYnJvd3NlcnMNCgkJLSBEZXRlY3RpbmcgdGhlIHBsdWctaW4gdmVyc2lvbiB2aWEgdGhlIG9iamVjdCBlbGVtZW50IGlzIG1vcmUgcHJlY2lzZSB0aGFuIHVzaW5nIHRoZSBwbHVnaW5zIGNvbGxlY3Rpb24gaXRlbSdzIGRlc2NyaXB0aW9uOg0KCQkgIGEuIEJvdGggcmVsZWFzZSBhbmQgYnVpbGQgbnVtYmVycyBjYW4gYmUgZGV0ZWN0ZWQNCgkJICBiLiBBdm9pZCB3cm9uZyBkZXNjcmlwdGlvbnMgYnkgY29ycnVwdCBpbnN0YWxsZXJzIHByb3ZpZGVkIGJ5IEFkb2JlDQoJCSAgYy4gQXZvaWQgd3JvbmcgZGVzY3JpcHRpb25zIGJ5IG11bHRpcGxlIEZsYXNoIFBsYXllciBlbnRyaWVzIGluIHRoZSBwbHVnaW4gQXJyYXksIGNhdXNlZCBieSBpbmNvcnJlY3QgYnJvd3NlciBpbXBvcnRzDQoJCS0gRGlzYWR2YW50YWdlIG9mIHRoaXMgbWV0aG9kIGlzIHRoYXQgaXQgZGVwZW5kcyBvbiB0aGUgYXZhaWxhYmlsaXR5IG9mIHRoZSBET00sIHdoaWxlIHRoZSBwbHVnaW5zIGNvbGxlY3Rpb24gaXMgaW1tZWRpYXRlbHkgYXZhaWxhYmxlDQoJKi8NCglmdW5jdGlvbiB0ZXN0UGxheWVyVmVyc2lvbigpIHsNCgkJdmFyIGIgPSBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsNCgkJdmFyIG8gPSBjcmVhdGVFbGVtZW50KE9CSkVDVCk7DQoJCW8uc2V0QXR0cmlidXRlKCJ0eXBlIiwgRkxBU0hfTUlNRV9UWVBFKTsNCgkJdmFyIHQgPSBiLmFwcGVuZENoaWxkKG8pOw0KCQlpZiAodCkgew0KCQkJdmFyIGNvdW50ZXIgPSAwOw0KCQkJKGZ1bmN0aW9uKCl7DQoJCQkJaWYgKHR5cGVvZiB0LkdldFZhcmlhYmxlICE9IFVOREVGKSB7DQoJCQkJCXZhciBkID0gdC5HZXRWYXJpYWJsZSgiJHZlcnNpb24iKTsNCgkJCQkJaWYgKGQpIHsNCgkJCQkJCWQgPSBkLnNwbGl0KCIgIilbMV0uc3BsaXQoIiwiKTsNCgkJCQkJCXVhLnB2ID0gW3BhcnNlSW50KGRbMF0sIDEwKSwgcGFyc2VJbnQoZFsxXSwgMTApLCBwYXJzZUludChkWzJdLCAxMCldOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCWVsc2UgaWYgKGNvdW50ZXIgPCAxMCkgew0KCQkJCQljb3VudGVyKys7DQoJCQkJCXNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwgMTApOw0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KCQkJCWIucmVtb3ZlQ2hpbGQobyk7DQoJCQkJdCA9IG51bGw7DQoJCQkJbWF0Y2hWZXJzaW9ucygpOw0KCQkJfSkoKTsNCgkJfQ0KCQllbHNlIHsNCgkJCW1hdGNoVmVyc2lvbnMoKTsNCgkJfQ0KCX0NCgkNCgkvKiBQZXJmb3JtIEZsYXNoIFBsYXllciBhbmQgU1dGIHZlcnNpb24gbWF0Y2hpbmc7IHN0YXRpYyBwdWJsaXNoaW5nIG9ubHkNCgkqLw0KCWZ1bmN0aW9uIG1hdGNoVmVyc2lvbnMoKSB7DQoJCXZhciBybCA9IHJlZ09iakFyci5sZW5ndGg7DQoJCWlmIChybCA+IDApIHsNCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmw7IGkrKykgeyAvLyBmb3IgZWFjaCByZWdpc3RlcmVkIG9iamVjdCBlbGVtZW50DQoJCQkJdmFyIGlkID0gcmVnT2JqQXJyW2ldLmlkOw0KCQkJCXZhciBjYiA9IHJlZ09iakFycltpXS5jYWxsYmFja0ZuOw0KCQkJCXZhciBjYk9iaiA9IHtzdWNjZXNzOmZhbHNlLCBpZDppZH07DQoJCQkJaWYgKHVhLnB2WzBdID4gMCkgew0KCQkJCQl2YXIgb2JqID0gZ2V0RWxlbWVudEJ5SWQoaWQpOw0KCQkJCQlpZiAob2JqKSB7DQoJCQkJCQlpZiAoaGFzUGxheWVyVmVyc2lvbihyZWdPYmpBcnJbaV0uc3dmVmVyc2lvbikgJiYgISh1YS53ayAmJiB1YS53ayA8IDMxMikpIHsgLy8gRmxhc2ggUGxheWVyIHZlcnNpb24gPj0gcHVibGlzaGVkIFNXRiB2ZXJzaW9uOiBIb3VzdG9uLCB3ZSBoYXZlIGEgbWF0Y2ghDQoJCQkJCQkJc2V0VmlzaWJpbGl0eShpZCwgdHJ1ZSk7DQoJCQkJCQkJaWYgKGNiKSB7DQoJCQkJCQkJCWNiT2JqLnN1Y2Nlc3MgPSB0cnVlOw0KCQkJCQkJCQljYk9iai5yZWYgPSBnZXRPYmplY3RCeUlkKGlkKTsNCgkJCQkJCQkJY2IoY2JPYmopOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJCWVsc2UgaWYgKHJlZ09iakFycltpXS5leHByZXNzSW5zdGFsbCAmJiBjYW5FeHByZXNzSW5zdGFsbCgpKSB7IC8vIHNob3cgdGhlIEFkb2JlIEV4cHJlc3MgSW5zdGFsbCBkaWFsb2cgaWYgc2V0IGJ5IHRoZSB3ZWIgcGFnZSBhdXRob3IgYW5kIGlmIHN1cHBvcnRlZA0KCQkJCQkJCXZhciBhdHQgPSB7fTsNCgkJCQkJCQlhdHQuZGF0YSA9IHJlZ09iakFycltpXS5leHByZXNzSW5zdGFsbDsNCgkJCQkJCQlhdHQud2lkdGggPSBvYmouZ2V0QXR0cmlidXRlKCJ3aWR0aCIpIHx8ICIwIjsNCgkJCQkJCQlhdHQuaGVpZ2h0ID0gb2JqLmdldEF0dHJpYnV0ZSgiaGVpZ2h0IikgfHwgIjAiOw0KCQkJCQkJCWlmIChvYmouZ2V0QXR0cmlidXRlKCJjbGFzcyIpKSB7IGF0dC5zdHlsZWNsYXNzID0gb2JqLmdldEF0dHJpYnV0ZSgiY2xhc3MiKTsgfQ0KCQkJCQkJCWlmIChvYmouZ2V0QXR0cmlidXRlKCJhbGlnbiIpKSB7IGF0dC5hbGlnbiA9IG9iai5nZXRBdHRyaWJ1dGUoImFsaWduIik7IH0NCgkJCQkJCQkvLyBwYXJzZSBIVE1MIG9iamVjdCBwYXJhbSBlbGVtZW50J3MgbmFtZS12YWx1ZSBwYWlycw0KCQkJCQkJCXZhciBwYXIgPSB7fTsNCgkJCQkJCQl2YXIgcCA9IG9iai5nZXRFbGVtZW50c0J5VGFnTmFtZSgicGFyYW0iKTsNCgkJCQkJCQl2YXIgcGwgPSBwLmxlbmd0aDsNCgkJCQkJCQlmb3IgKHZhciBqID0gMDsgaiA8IHBsOyBqKyspIHsNCgkJCQkJCQkJaWYgKHBbal0uZ2V0QXR0cmlidXRlKCJuYW1lIikudG9Mb3dlckNhc2UoKSAhPSAibW92aWUiKSB7DQoJCQkJCQkJCQlwYXJbcFtqXS5nZXRBdHRyaWJ1dGUoIm5hbWUiKV0gPSBwW2pdLmdldEF0dHJpYnV0ZSgidmFsdWUiKTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCQlzaG93RXhwcmVzc0luc3RhbGwoYXR0LCBwYXIsIGlkLCBjYik7DQoJCQkJCQl9DQoJCQkJCQllbHNlIHsgLy8gRmxhc2ggUGxheWVyIGFuZCBTV0YgdmVyc2lvbiBtaXNtYXRjaCBvciBhbiBvbGRlciBXZWJraXQgZW5naW5lIHRoYXQgaWdub3JlcyB0aGUgSFRNTCBvYmplY3QgZWxlbWVudCdzIG5lc3RlZCBwYXJhbSBlbGVtZW50czogZGlzcGxheSBhbHRlcm5hdGl2ZSBjb250ZW50IGluc3RlYWQgb2YgU1dGDQoJCQkJCQkJZGlzcGxheUFsdENvbnRlbnQob2JqKTsNCgkJCQkJCQlpZiAoY2IpIHsgY2IoY2JPYmopOyB9DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJZWxzZSB7CS8vIGlmIG5vIEZsYXNoIFBsYXllciBpcyBpbnN0YWxsZWQgb3IgdGhlIGZwIHZlcnNpb24gY2Fubm90IGJlIGRldGVjdGVkIHdlIGxldCB0aGUgSFRNTCBvYmplY3QgZWxlbWVudCBkbyBpdHMgam9iIChlaXRoZXIgc2hvdyBhIFNXRiBvciBhbHRlcm5hdGl2ZSBjb250ZW50KQ0KCQkJCQlzZXRWaXNpYmlsaXR5KGlkLCB0cnVlKTsNCgkJCQkJaWYgKGNiKSB7DQoJCQkJCQl2YXIgbyA9IGdldE9iamVjdEJ5SWQoaWQpOyAvLyB0ZXN0IHdoZXRoZXIgdGhlcmUgaXMgYW4gSFRNTCBvYmplY3QgZWxlbWVudCBvciBub3QNCgkJCQkJCWlmIChvICYmIHR5cGVvZiBvLlNldFZhcmlhYmxlICE9IFVOREVGKSB7IA0KCQkJCQkJCWNiT2JqLnN1Y2Nlc3MgPSB0cnVlOw0KCQkJCQkJCWNiT2JqLnJlZiA9IG87DQoJCQkJCQl9DQoJCQkJCQljYihjYk9iaik7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQoJDQoJZnVuY3Rpb24gZ2V0T2JqZWN0QnlJZChvYmplY3RJZFN0cikgew0KCQl2YXIgciA9IG51bGw7DQoJCXZhciBvID0gZ2V0RWxlbWVudEJ5SWQob2JqZWN0SWRTdHIpOw0KCQlpZiAobyAmJiBvLm5vZGVOYW1lID09ICJPQkpFQ1QiKSB7DQoJCQlpZiAodHlwZW9mIG8uU2V0VmFyaWFibGUgIT0gVU5ERUYpIHsNCgkJCQlyID0gbzsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCXZhciBuID0gby5nZXRFbGVtZW50c0J5VGFnTmFtZShPQkpFQ1QpWzBdOw0KCQkJCWlmIChuKSB7DQoJCQkJCXIgPSBuOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlyZXR1cm4gcjsNCgl9DQoJDQoJLyogUmVxdWlyZW1lbnRzIGZvciBBZG9iZSBFeHByZXNzIEluc3RhbGwNCgkJLSBvbmx5IG9uZSBpbnN0YW5jZSBjYW4gYmUgYWN0aXZlIGF0IGEgdGltZQ0KCQktIGZwIDYuMC42NSBvciBoaWdoZXINCgkJLSBXaW4vTWFjIE9TIG9ubHkNCgkJLSBubyBXZWJraXQgZW5naW5lcyBvbGRlciB0aGFuIHZlcnNpb24gMzEyDQoJKi8NCglmdW5jdGlvbiBjYW5FeHByZXNzSW5zdGFsbCgpIHsNCgkJcmV0dXJuICFpc0V4cHJlc3NJbnN0YWxsQWN0aXZlICYmIGhhc1BsYXllclZlcnNpb24oIjYuMC42NSIpICYmICh1YS53aW4gfHwgdWEubWFjKSAmJiAhKHVhLndrICYmIHVhLndrIDwgMzEyKTsNCgl9DQoJDQoJLyogU2hvdyB0aGUgQWRvYmUgRXhwcmVzcyBJbnN0YWxsIGRpYWxvZw0KCQktIFJlZmVyZW5jZTogaHR0cDovL3d3dy5hZG9iZS5jb20vY2Z1c2lvbi9rbm93bGVkZ2ViYXNlL2luZGV4LmNmbT9pZD02YTI1M2I3NQ0KCSovDQoJZnVuY3Rpb24gc2hvd0V4cHJlc3NJbnN0YWxsKGF0dCwgcGFyLCByZXBsYWNlRWxlbUlkU3RyLCBjYWxsYmFja0ZuKSB7DQoJCWlzRXhwcmVzc0luc3RhbGxBY3RpdmUgPSB0cnVlOw0KCQlzdG9yZWRDYWxsYmFja0ZuID0gY2FsbGJhY2tGbiB8fCBudWxsOw0KCQlzdG9yZWRDYWxsYmFja09iaiA9IHtzdWNjZXNzOmZhbHNlLCBpZDpyZXBsYWNlRWxlbUlkU3RyfTsNCgkJdmFyIG9iaiA9IGdldEVsZW1lbnRCeUlkKHJlcGxhY2VFbGVtSWRTdHIpOw0KCQlpZiAob2JqKSB7DQoJCQlpZiAob2JqLm5vZGVOYW1lID09ICJPQkpFQ1QiKSB7IC8vIHN0YXRpYyBwdWJsaXNoaW5nDQoJCQkJc3RvcmVkQWx0Q29udGVudCA9IGFic3RyYWN0QWx0Q29udGVudChvYmopOw0KCQkJCXN0b3JlZEFsdENvbnRlbnRJZCA9IG51bGw7DQoJCQl9DQoJCQllbHNlIHsgLy8gZHluYW1pYyBwdWJsaXNoaW5nDQoJCQkJc3RvcmVkQWx0Q29udGVudCA9IG9iajsNCgkJCQlzdG9yZWRBbHRDb250ZW50SWQgPSByZXBsYWNlRWxlbUlkU3RyOw0KCQkJfQ0KCQkJYXR0LmlkID0gRVhQUkVTU19JTlNUQUxMX0lEOw0KCQkJaWYgKHR5cGVvZiBhdHQud2lkdGggPT0gVU5ERUYgfHwgKCEvJSQvLnRlc3QoYXR0LndpZHRoKSAmJiBwYXJzZUludChhdHQud2lkdGgsIDEwKSA8IDMxMCkpIHsgYXR0LndpZHRoID0gIjMxMCI7IH0NCgkJCWlmICh0eXBlb2YgYXR0LmhlaWdodCA9PSBVTkRFRiB8fCAoIS8lJC8udGVzdChhdHQuaGVpZ2h0KSAmJiBwYXJzZUludChhdHQuaGVpZ2h0LCAxMCkgPCAxMzcpKSB7IGF0dC5oZWlnaHQgPSAiMTM3IjsgfQ0KCQkJZG9jLnRpdGxlID0gZG9jLnRpdGxlLnNsaWNlKDAsIDQ3KSArICIgLSBGbGFzaCBQbGF5ZXIgSW5zdGFsbGF0aW9uIjsNCgkJCXZhciBwdCA9IHVhLmllICYmIHVhLndpbiA/ICJBY3RpdmVYIiA6ICJQbHVnSW4iLA0KCQkJCWZ2ID0gIk1NcmVkaXJlY3RVUkw9IiArIGVuY29kZVVSSSh3aW5kb3cubG9jYXRpb24pLnRvU3RyaW5nKCkucmVwbGFjZSgvJi9nLCIlMjYiKSArICImTU1wbGF5ZXJUeXBlPSIgKyBwdCArICImTU1kb2N0aXRsZT0iICsgZG9jLnRpdGxlOw0KCQkJaWYgKHR5cGVvZiBwYXIuZmxhc2h2YXJzICE9IFVOREVGKSB7DQoJCQkJcGFyLmZsYXNodmFycyArPSAiJiIgKyBmdjsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCXBhci5mbGFzaHZhcnMgPSBmdjsNCgkJCX0NCgkJCS8vIElFIG9ubHk6IHdoZW4gYSBTV0YgaXMgbG9hZGluZyAoQU5EOiBub3QgYXZhaWxhYmxlIGluIGNhY2hlKSB3YWl0IGZvciB0aGUgcmVhZHlTdGF0ZSBvZiB0aGUgb2JqZWN0IGVsZW1lbnQgdG8gYmVjb21lIDQgYmVmb3JlIHJlbW92aW5nIGl0LA0KCQkJLy8gYmVjYXVzZSB5b3UgY2Fubm90IHByb3Blcmx5IGNhbmNlbCBhIGxvYWRpbmcgU1dGIGZpbGUgd2l0aG91dCBicmVha2luZyBicm93c2VyIGxvYWQgcmVmZXJlbmNlcywgYWxzbyBvYmoub25yZWFkeXN0YXRlY2hhbmdlIGRvZXNuJ3Qgd29yaw0KCQkJaWYgKHVhLmllICYmIHVhLndpbiAmJiBvYmoucmVhZHlTdGF0ZSAhPSA0KSB7DQoJCQkJdmFyIG5ld09iaiA9IGNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCXJlcGxhY2VFbGVtSWRTdHIgKz0gIlNXRk9iamVjdE5ldyI7DQoJCQkJbmV3T2JqLnNldEF0dHJpYnV0ZSgiaWQiLCByZXBsYWNlRWxlbUlkU3RyKTsNCgkJCQlvYmoucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3T2JqLCBvYmopOyAvLyBpbnNlcnQgcGxhY2Vob2xkZXIgZGl2IHRoYXQgd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgb2JqZWN0IGVsZW1lbnQgdGhhdCBsb2FkcyBleHByZXNzaW5zdGFsbC5zd2YNCgkJCQlvYmouc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCQkoZnVuY3Rpb24oKXsNCgkJCQkJaWYgKG9iai5yZWFkeVN0YXRlID09IDQpIHsNCgkJCQkJCW9iai5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iaik7DQoJCQkJCX0NCgkJCQkJZWxzZSB7DQoJCQkJCQlzZXRUaW1lb3V0KGFyZ3VtZW50cy5jYWxsZWUsIDEwKTsNCgkJCQkJfQ0KCQkJCX0pKCk7DQoJCQl9DQoJCQljcmVhdGVTV0YoYXR0LCBwYXIsIHJlcGxhY2VFbGVtSWRTdHIpOw0KCQl9DQoJfQ0KCQ0KCS8qIEZ1bmN0aW9ucyB0byBhYnN0cmFjdCBhbmQgZGlzcGxheSBhbHRlcm5hdGl2ZSBjb250ZW50DQoJKi8NCglmdW5jdGlvbiBkaXNwbGF5QWx0Q29udGVudChvYmopIHsNCgkJaWYgKHVhLmllICYmIHVhLndpbiAmJiBvYmoucmVhZHlTdGF0ZSAhPSA0KSB7DQoJCQkvLyBJRSBvbmx5OiB3aGVuIGEgU1dGIGlzIGxvYWRpbmcgKEFORDogbm90IGF2YWlsYWJsZSBpbiBjYWNoZSkgd2FpdCBmb3IgdGhlIHJlYWR5U3RhdGUgb2YgdGhlIG9iamVjdCBlbGVtZW50IHRvIGJlY29tZSA0IGJlZm9yZSByZW1vdmluZyBpdCwNCgkJCS8vIGJlY2F1c2UgeW91IGNhbm5vdCBwcm9wZXJseSBjYW5jZWwgYSBsb2FkaW5nIFNXRiBmaWxlIHdpdGhvdXQgYnJlYWtpbmcgYnJvd3NlciBsb2FkIHJlZmVyZW5jZXMsIGFsc28gb2JqLm9ucmVhZHlzdGF0ZWNoYW5nZSBkb2Vzbid0IHdvcmsNCgkJCXZhciBlbCA9IGNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJb2JqLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGVsLCBvYmopOyAvLyBpbnNlcnQgcGxhY2Vob2xkZXIgZGl2IHRoYXQgd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgYWx0ZXJuYXRpdmUgY29udGVudA0KCQkJZWwucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoYWJzdHJhY3RBbHRDb250ZW50KG9iaiksIGVsKTsNCgkJCW9iai5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJKGZ1bmN0aW9uKCl7DQoJCQkJaWYgKG9iai5yZWFkeVN0YXRlID09IDQpIHsNCgkJCQkJb2JqLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqKTsNCgkJCQl9DQoJCQkJZWxzZSB7DQoJCQkJCXNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwgMTApOw0KCQkJCX0NCgkJCX0pKCk7DQoJCX0NCgkJZWxzZSB7DQoJCQlvYmoucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoYWJzdHJhY3RBbHRDb250ZW50KG9iaiksIG9iaik7DQoJCX0NCgl9IA0KDQoJZnVuY3Rpb24gYWJzdHJhY3RBbHRDb250ZW50KG9iaikgew0KCQl2YXIgYWMgPSBjcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJaWYgKHVhLndpbiAmJiB1YS5pZSkgew0KCQkJYWMuaW5uZXJIVE1MID0gb2JqLmlubmVySFRNTDsNCgkJfQ0KCQllbHNlIHsNCgkJCXZhciBuZXN0ZWRPYmogPSBvYmouZ2V0RWxlbWVudHNCeVRhZ05hbWUoT0JKRUNUKVswXTsNCgkJCWlmIChuZXN0ZWRPYmopIHsNCgkJCQl2YXIgYyA9IG5lc3RlZE9iai5jaGlsZE5vZGVzOw0KCQkJCWlmIChjKSB7DQoJCQkJCXZhciBjbCA9IGMubGVuZ3RoOw0KCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNsOyBpKyspIHsNCgkJCQkJCWlmICghKGNbaV0ubm9kZVR5cGUgPT0gMSAmJiBjW2ldLm5vZGVOYW1lID09ICJQQVJBTSIpICYmICEoY1tpXS5ub2RlVHlwZSA9PSA4KSkgew0KCQkJCQkJCWFjLmFwcGVuZENoaWxkKGNbaV0uY2xvbmVOb2RlKHRydWUpKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KCQlyZXR1cm4gYWM7DQoJfQ0KCQ0KCS8qIENyb3NzLWJyb3dzZXIgZHluYW1pYyBTV0YgY3JlYXRpb24NCgkqLw0KCWZ1bmN0aW9uIGNyZWF0ZVNXRihhdHRPYmosIHBhck9iaiwgaWQpIHsNCgkJdmFyIHIsIGVsID0gZ2V0RWxlbWVudEJ5SWQoaWQpOw0KCQlpZiAodWEud2sgJiYgdWEud2sgPCAzMTIpIHsgcmV0dXJuIHI7IH0NCgkJaWYgKGVsKSB7DQoJCQlpZiAodHlwZW9mIGF0dE9iai5pZCA9PSBVTkRFRikgeyAvLyBpZiBubyAnaWQnIGlzIGRlZmluZWQgZm9yIHRoZSBvYmplY3QgZWxlbWVudCwgaXQgd2lsbCBpbmhlcml0IHRoZSAnaWQnIGZyb20gdGhlIGFsdGVybmF0aXZlIGNvbnRlbnQNCgkJCQlhdHRPYmouaWQgPSBpZDsNCgkJCX0NCgkJCWlmICh1YS5pZSAmJiB1YS53aW4pIHsgLy8gSW50ZXJuZXQgRXhwbG9yZXIgKyB0aGUgSFRNTCBvYmplY3QgZWxlbWVudCArIFczQyBET00gbWV0aG9kcyBkbyBub3QgY29tYmluZTogZmFsbCBiYWNrIHRvIG91dGVySFRNTA0KCQkJCXZhciBhdHQgPSAiIjsNCgkJCQlmb3IgKHZhciBpIGluIGF0dE9iaikgew0KCQkJCQlpZiAoYXR0T2JqW2ldICE9IE9iamVjdC5wcm90b3R5cGVbaV0pIHsgLy8gZmlsdGVyIG91dCBwcm90b3R5cGUgYWRkaXRpb25zIGZyb20gb3RoZXIgcG90ZW50aWFsIGxpYnJhcmllcw0KCQkJCQkJaWYgKGkudG9Mb3dlckNhc2UoKSA9PSAiZGF0YSIpIHsNCgkJCQkJCQlwYXJPYmoubW92aWUgPSBhdHRPYmpbaV07DQoJCQkJCQl9DQoJCQkJCQllbHNlIGlmIChpLnRvTG93ZXJDYXNlKCkgPT0gInN0eWxlY2xhc3MiKSB7IC8vICdjbGFzcycgaXMgYW4gRUNNQTQgcmVzZXJ2ZWQga2V5d29yZA0KCQkJCQkJCWF0dCArPSAnIGNsYXNzPSInICsgYXR0T2JqW2ldICsgJyInOw0KCQkJCQkJfQ0KCQkJCQkJZWxzZSBpZiAoaS50b0xvd2VyQ2FzZSgpICE9ICJjbGFzc2lkIikgew0KCQkJCQkJCWF0dCArPSAnICcgKyBpICsgJz0iJyArIGF0dE9ialtpXSArICciJzsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQl2YXIgcGFyID0gIiI7DQoJCQkJZm9yICh2YXIgaiBpbiBwYXJPYmopIHsNCgkJCQkJaWYgKHBhck9ialtqXSAhPSBPYmplY3QucHJvdG90eXBlW2pdKSB7IC8vIGZpbHRlciBvdXQgcHJvdG90eXBlIGFkZGl0aW9ucyBmcm9tIG90aGVyIHBvdGVudGlhbCBsaWJyYXJpZXMNCgkJCQkJCXBhciArPSAnPHBhcmFtIG5hbWU9IicgKyBqICsgJyIgdmFsdWU9IicgKyBwYXJPYmpbal0gKyAnIiAvPic7DQoJCQkJCX0NCgkJCQl9DQoJCQkJZWwub3V0ZXJIVE1MID0gJzxvYmplY3QgY2xhc3NpZD0iY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIicgKyBhdHQgKyAnPicgKyBwYXIgKyAnPC9vYmplY3Q+JzsNCgkJCQlvYmpJZEFycltvYmpJZEFyci5sZW5ndGhdID0gYXR0T2JqLmlkOyAvLyBzdG9yZWQgdG8gZml4IG9iamVjdCAnbGVha3MnIG9uIHVubG9hZCAoZHluYW1pYyBwdWJsaXNoaW5nIG9ubHkpDQoJCQkJciA9IGdldEVsZW1lbnRCeUlkKGF0dE9iai5pZCk7CQ0KCQkJfQ0KCQkJZWxzZSB7IC8vIHdlbGwtYmVoYXZpbmcgYnJvd3NlcnMNCgkJCQl2YXIgbyA9IGNyZWF0ZUVsZW1lbnQoT0JKRUNUKTsNCgkJCQlvLnNldEF0dHJpYnV0ZSgidHlwZSIsIEZMQVNIX01JTUVfVFlQRSk7DQoJCQkJZm9yICh2YXIgbSBpbiBhdHRPYmopIHsNCgkJCQkJaWYgKGF0dE9ialttXSAhPSBPYmplY3QucHJvdG90eXBlW21dKSB7IC8vIGZpbHRlciBvdXQgcHJvdG90eXBlIGFkZGl0aW9ucyBmcm9tIG90aGVyIHBvdGVudGlhbCBsaWJyYXJpZXMNCgkJCQkJCWlmIChtLnRvTG93ZXJDYXNlKCkgPT0gInN0eWxlY2xhc3MiKSB7IC8vICdjbGFzcycgaXMgYW4gRUNNQTQgcmVzZXJ2ZWQga2V5d29yZA0KCQkJCQkJCW8uc2V0QXR0cmlidXRlKCJjbGFzcyIsIGF0dE9ialttXSk7DQoJCQkJCQl9DQoJCQkJCQllbHNlIGlmIChtLnRvTG93ZXJDYXNlKCkgIT0gImNsYXNzaWQiKSB7IC8vIGZpbHRlciBvdXQgSUUgc3BlY2lmaWMgYXR0cmlidXRlDQoJCQkJCQkJby5zZXRBdHRyaWJ1dGUobSwgYXR0T2JqW21dKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQlmb3IgKHZhciBuIGluIHBhck9iaikgew0KCQkJCQlpZiAocGFyT2JqW25dICE9IE9iamVjdC5wcm90b3R5cGVbbl0gJiYgbi50b0xvd2VyQ2FzZSgpICE9ICJtb3ZpZSIpIHsgLy8gZmlsdGVyIG91dCBwcm90b3R5cGUgYWRkaXRpb25zIGZyb20gb3RoZXIgcG90ZW50aWFsIGxpYnJhcmllcyBhbmQgSUUgc3BlY2lmaWMgcGFyYW0gZWxlbWVudA0KCQkJCQkJY3JlYXRlT2JqUGFyYW0obywgbiwgcGFyT2JqW25dKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQllbC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChvLCBlbCk7DQoJCQkJciA9IG87DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHI7DQoJfQ0KCQ0KCWZ1bmN0aW9uIGNyZWF0ZU9ialBhcmFtKGVsLCBwTmFtZSwgcFZhbHVlKSB7DQoJCXZhciBwID0gY3JlYXRlRWxlbWVudCgicGFyYW0iKTsNCgkJcC5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBwTmFtZSk7CQ0KCQlwLnNldEF0dHJpYnV0ZSgidmFsdWUiLCBwVmFsdWUpOw0KCQllbC5hcHBlbmRDaGlsZChwKTsNCgl9DQoJDQoJLyogQ3Jvc3MtYnJvd3NlciBTV0YgcmVtb3ZhbA0KCQktIEVzcGVjaWFsbHkgbmVlZGVkIHRvIHNhZmVseSBhbmQgY29tcGxldGVseSByZW1vdmUgYSBTV0YgaW4gSW50ZXJuZXQgRXhwbG9yZXINCgkqLw0KCWZ1bmN0aW9uIHJlbW92ZVNXRihpZCkgew0KCQl2YXIgb2JqID0gZ2V0RWxlbWVudEJ5SWQoaWQpOw0KCQlpZiAob2JqICYmIG9iai5ub2RlTmFtZSA9PSAiT0JKRUNUIikgew0KCQkJaWYgKHVhLmllICYmIHVhLndpbikgew0KCQkJCW9iai5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJCShmdW5jdGlvbigpew0KCQkJCQlpZiAob2JqLnJlYWR5U3RhdGUgPT0gNCkgew0KCQkJCQkJcmVtb3ZlT2JqZWN0SW5JRShpZCk7DQoJCQkJCX0NCgkJCQkJZWxzZSB7DQoJCQkJCQlzZXRUaW1lb3V0KGFyZ3VtZW50cy5jYWxsZWUsIDEwKTsNCgkJCQkJfQ0KCQkJCX0pKCk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQlvYmoucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmopOw0KCQkJfQ0KCQl9DQoJfQ0KCQ0KCWZ1bmN0aW9uIHJlbW92ZU9iamVjdEluSUUoaWQpIHsNCgkJdmFyIG9iaiA9IGdldEVsZW1lbnRCeUlkKGlkKTsNCgkJaWYgKG9iaikgew0KCQkJZm9yICh2YXIgaSBpbiBvYmopIHsNCgkJCQlpZiAodHlwZW9mIG9ialtpXSA9PSAiZnVuY3Rpb24iKSB7DQoJCQkJCW9ialtpXSA9IG51bGw7DQoJCQkJfQ0KCQkJfQ0KCQkJb2JqLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQob2JqKTsNCgkJfQ0KCX0NCgkNCgkvKiBGdW5jdGlvbnMgdG8gb3B0aW1pemUgSmF2YVNjcmlwdCBjb21wcmVzc2lvbg0KCSovDQoJZnVuY3Rpb24gZ2V0RWxlbWVudEJ5SWQoaWQpIHsNCgkJdmFyIGVsID0gbnVsbDsNCgkJdHJ5IHsNCgkJCWVsID0gZG9jLmdldEVsZW1lbnRCeUlkKGlkKTsNCgkJfQ0KCQljYXRjaCAoZSkge30NCgkJcmV0dXJuIGVsOw0KCX0NCgkNCglmdW5jdGlvbiBjcmVhdGVFbGVtZW50KGVsKSB7DQoJCXJldHVybiBkb2MuY3JlYXRlRWxlbWVudChlbCk7DQoJfQ0KCQ0KCS8qIFVwZGF0ZWQgYXR0YWNoRXZlbnQgZnVuY3Rpb24gZm9yIEludGVybmV0IEV4cGxvcmVyDQoJCS0gU3RvcmVzIGF0dGFjaEV2ZW50IGluZm9ybWF0aW9uIGluIGFuIEFycmF5LCBzbyBvbiB1bmxvYWQgdGhlIGRldGFjaEV2ZW50IGZ1bmN0aW9ucyBjYW4gYmUgY2FsbGVkIHRvIGF2b2lkIG1lbW9yeSBsZWFrcw0KCSovCQ0KCWZ1bmN0aW9uIGFkZExpc3RlbmVyKHRhcmdldCwgZXZlbnRUeXBlLCBmbikgew0KCQl0YXJnZXQuYXR0YWNoRXZlbnQoZXZlbnRUeXBlLCBmbik7DQoJCWxpc3RlbmVyc0FycltsaXN0ZW5lcnNBcnIubGVuZ3RoXSA9IFt0YXJnZXQsIGV2ZW50VHlwZSwgZm5dOw0KCX0NCgkNCgkvKiBGbGFzaCBQbGF5ZXIgYW5kIFNXRiBjb250ZW50IHZlcnNpb24gbWF0Y2hpbmcNCgkqLw0KCWZ1bmN0aW9uIGhhc1BsYXllclZlcnNpb24ocnYpIHsNCgkJdmFyIHB2ID0gdWEucHYsIHYgPSBydi5zcGxpdCgiLiIpOw0KCQl2WzBdID0gcGFyc2VJbnQodlswXSwgMTApOw0KCQl2WzFdID0gcGFyc2VJbnQodlsxXSwgMTApIHx8IDA7IC8vIHN1cHBvcnRzIHNob3J0IG5vdGF0aW9uLCBlLmcuICI5IiBpbnN0ZWFkIG9mICI5LjAuMCINCgkJdlsyXSA9IHBhcnNlSW50KHZbMl0sIDEwKSB8fCAwOw0KCQlyZXR1cm4gKHB2WzBdID4gdlswXSB8fCAocHZbMF0gPT0gdlswXSAmJiBwdlsxXSA+IHZbMV0pIHx8IChwdlswXSA9PSB2WzBdICYmIHB2WzFdID09IHZbMV0gJiYgcHZbMl0gPj0gdlsyXSkpID8gdHJ1ZSA6IGZhbHNlOw0KCX0NCgkNCgkvKiBDcm9zcy1icm93c2VyIGR5bmFtaWMgQ1NTIGNyZWF0aW9uDQoJCS0gQmFzZWQgb24gQm9iYnkgdmFuIGRlciBTbHVpcycgc29sdXRpb246IGh0dHA6Ly93d3cuYm9iYnl2YW5kZXJzbHVpcy5jb20vYXJ0aWNsZXMvZHluYW1pY0NTUy5waHANCgkqLwkNCglmdW5jdGlvbiBjcmVhdGVDU1Moc2VsLCBkZWNsLCBtZWRpYSwgbmV3U3R5bGUpIHsNCgkJaWYgKHVhLmllICYmIHVhLm1hYykgeyByZXR1cm47IH0NCgkJdmFyIGggPSBkb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXTsNCgkJaWYgKCFoKSB7IHJldHVybjsgfSAvLyB0byBhbHNvIHN1cHBvcnQgYmFkbHkgYXV0aG9yZWQgSFRNTCBwYWdlcyB0aGF0IGxhY2sgYSBoZWFkIGVsZW1lbnQNCgkJdmFyIG0gPSAobWVkaWEgJiYgdHlwZW9mIG1lZGlhID09ICJzdHJpbmciKSA/IG1lZGlhIDogInNjcmVlbiI7DQoJCWlmIChuZXdTdHlsZSkgew0KCQkJZHluYW1pY1N0eWxlc2hlZXQgPSBudWxsOw0KCQkJZHluYW1pY1N0eWxlc2hlZXRNZWRpYSA9IG51bGw7DQoJCX0NCgkJaWYgKCFkeW5hbWljU3R5bGVzaGVldCB8fCBkeW5hbWljU3R5bGVzaGVldE1lZGlhICE9IG0pIHsgDQoJCQkvLyBjcmVhdGUgZHluYW1pYyBzdHlsZXNoZWV0ICsgZ2V0IGEgZ2xvYmFsIHJlZmVyZW5jZSB0byBpdA0KCQkJdmFyIHMgPSBjcmVhdGVFbGVtZW50KCJzdHlsZSIpOw0KCQkJcy5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dC9jc3MiKTsNCgkJCXMuc2V0QXR0cmlidXRlKCJtZWRpYSIsIG0pOw0KCQkJZHluYW1pY1N0eWxlc2hlZXQgPSBoLmFwcGVuZENoaWxkKHMpOw0KCQkJaWYgKHVhLmllICYmIHVhLndpbiAmJiB0eXBlb2YgZG9jLnN0eWxlU2hlZXRzICE9IFVOREVGICYmIGRvYy5zdHlsZVNoZWV0cy5sZW5ndGggPiAwKSB7DQoJCQkJZHluYW1pY1N0eWxlc2hlZXQgPSBkb2Muc3R5bGVTaGVldHNbZG9jLnN0eWxlU2hlZXRzLmxlbmd0aCAtIDFdOw0KCQkJfQ0KCQkJZHluYW1pY1N0eWxlc2hlZXRNZWRpYSA9IG07DQoJCX0NCgkJLy8gYWRkIHN0eWxlIHJ1bGUNCgkJaWYgKHVhLmllICYmIHVhLndpbikgew0KCQkJaWYgKGR5bmFtaWNTdHlsZXNoZWV0ICYmIHR5cGVvZiBkeW5hbWljU3R5bGVzaGVldC5hZGRSdWxlID09IE9CSkVDVCkgew0KCQkJCWR5bmFtaWNTdHlsZXNoZWV0LmFkZFJ1bGUoc2VsLCBkZWNsKTsNCgkJCX0NCgkJfQ0KCQllbHNlIHsNCgkJCWlmIChkeW5hbWljU3R5bGVzaGVldCAmJiB0eXBlb2YgZG9jLmNyZWF0ZVRleHROb2RlICE9IFVOREVGKSB7DQoJCQkJZHluYW1pY1N0eWxlc2hlZXQuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZVRleHROb2RlKHNlbCArICIgeyIgKyBkZWNsICsgIn0iKSk7DQoJCQl9DQoJCX0NCgl9DQoJDQoJZnVuY3Rpb24gc2V0VmlzaWJpbGl0eShpZCwgaXNWaXNpYmxlKSB7DQoJCWlmICghYXV0b0hpZGVTaG93KSB7IHJldHVybjsgfQ0KCQl2YXIgdiA9IGlzVmlzaWJsZSA/ICJ2aXNpYmxlIiA6ICJoaWRkZW4iOw0KCQlpZiAoaXNEb21Mb2FkZWQgJiYgZ2V0RWxlbWVudEJ5SWQoaWQpKSB7DQoJCQlnZXRFbGVtZW50QnlJZChpZCkuc3R5bGUudmlzaWJpbGl0eSA9IHY7DQoJCX0NCgkJZWxzZSB7DQoJCQljcmVhdGVDU1MoIiMiICsgaWQsICJ2aXNpYmlsaXR5OiIgKyB2KTsNCgkJfQ0KCX0NCg0KCS8qIEZpbHRlciB0byBhdm9pZCBYU1MgYXR0YWNrcw0KCSovDQoJZnVuY3Rpb24gdXJsRW5jb2RlSWZOZWNlc3Nhcnkocykgew0KCQl2YXIgcmVnZXggPSAvW1xcXCI8PlwuO10vOw0KCQl2YXIgaGFzQmFkQ2hhcnMgPSByZWdleC5leGVjKHMpICE9IG51bGw7DQoJCXJldHVybiBoYXNCYWRDaGFycyAmJiB0eXBlb2YgZW5jb2RlVVJJQ29tcG9uZW50ICE9IFVOREVGID8gZW5jb2RlVVJJQ29tcG9uZW50KHMpIDogczsNCgl9DQoJDQoJLyogUmVsZWFzZSBtZW1vcnkgdG8gYXZvaWQgbWVtb3J5IGxlYWtzIGNhdXNlZCBieSBjbG9zdXJlcywgZml4IGhhbmdpbmcgYXVkaW8vdmlkZW8gdGhyZWFkcyBhbmQgZm9yY2Ugb3BlbiBzb2NrZXRzL05ldENvbm5lY3Rpb25zIHRvIGRpc2Nvbm5lY3QgKEludGVybmV0IEV4cGxvcmVyIG9ubHkpDQoJKi8NCgl2YXIgY2xlYW51cCA9IGZ1bmN0aW9uKCkgew0KCQlpZiAodWEuaWUgJiYgdWEud2luKSB7DQoJCQl3aW5kb3cuYXR0YWNoRXZlbnQoIm9udW5sb2FkIiwgZnVuY3Rpb24oKSB7DQoJCQkJLy8gcmVtb3ZlIGxpc3RlbmVycyB0byBhdm9pZCBtZW1vcnkgbGVha3MNCgkJCQl2YXIgbGwgPSBsaXN0ZW5lcnNBcnIubGVuZ3RoOw0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbGw7IGkrKykgew0KCQkJCQlsaXN0ZW5lcnNBcnJbaV1bMF0uZGV0YWNoRXZlbnQobGlzdGVuZXJzQXJyW2ldWzFdLCBsaXN0ZW5lcnNBcnJbaV1bMl0pOw0KCQkJCX0NCgkJCQkvLyBjbGVhbnVwIGR5bmFtaWNhbGx5IGVtYmVkZGVkIG9iamVjdHMgdG8gZml4IGF1ZGlvL3ZpZGVvIHRocmVhZHMgYW5kIGZvcmNlIG9wZW4gc29ja2V0cyBhbmQgTmV0Q29ubmVjdGlvbnMgdG8gZGlzY29ubmVjdA0KCQkJCXZhciBpbCA9IG9iaklkQXJyLmxlbmd0aDsNCgkJCQlmb3IgKHZhciBqID0gMDsgaiA8IGlsOyBqKyspIHsNCgkJCQkJcmVtb3ZlU1dGKG9iaklkQXJyW2pdKTsNCgkJCQl9DQoJCQkJLy8gY2xlYW51cCBsaWJyYXJ5J3MgbWFpbiBjbG9zdXJlcyB0byBhdm9pZCBtZW1vcnkgbGVha3MNCgkJCQlmb3IgKHZhciBrIGluIHVhKSB7DQoJCQkJCXVhW2tdID0gbnVsbDsNCgkJCQl9DQoJCQkJdWEgPSBudWxsOw0KCQkJCWZvciAodmFyIGwgaW4gc3dmb2JqZWN0KSB7DQoJCQkJCXN3Zm9iamVjdFtsXSA9IG51bGw7DQoJCQkJfQ0KCQkJCXN3Zm9iamVjdCA9IG51bGw7DQoJCQl9KTsNCgkJfQ0KCX0oKTsNCgkNCglyZXR1cm4gew0KCQkvKiBQdWJsaWMgQVBJDQoJCQktIFJlZmVyZW5jZTogaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL3N3Zm9iamVjdC93aWtpL2RvY3VtZW50YXRpb24NCgkJKi8gDQoJCXJlZ2lzdGVyT2JqZWN0OiBmdW5jdGlvbihvYmplY3RJZFN0ciwgc3dmVmVyc2lvblN0ciwgeGlTd2ZVcmxTdHIsIGNhbGxiYWNrRm4pIHsNCgkJCWlmICh1YS53MyAmJiBvYmplY3RJZFN0ciAmJiBzd2ZWZXJzaW9uU3RyKSB7DQoJCQkJdmFyIHJlZ09iaiA9IHt9Ow0KCQkJCXJlZ09iai5pZCA9IG9iamVjdElkU3RyOw0KCQkJCXJlZ09iai5zd2ZWZXJzaW9uID0gc3dmVmVyc2lvblN0cjsNCgkJCQlyZWdPYmouZXhwcmVzc0luc3RhbGwgPSB4aVN3ZlVybFN0cjsNCgkJCQlyZWdPYmouY2FsbGJhY2tGbiA9IGNhbGxiYWNrRm47DQoJCQkJcmVnT2JqQXJyW3JlZ09iakFyci5sZW5ndGhdID0gcmVnT2JqOw0KCQkJCXNldFZpc2liaWxpdHkob2JqZWN0SWRTdHIsIGZhbHNlKTsNCgkJCX0NCgkJCWVsc2UgaWYgKGNhbGxiYWNrRm4pIHsNCgkJCQljYWxsYmFja0ZuKHtzdWNjZXNzOmZhbHNlLCBpZDpvYmplY3RJZFN0cn0pOw0KCQkJfQ0KCQl9LA0KCQkNCgkJZ2V0T2JqZWN0QnlJZDogZnVuY3Rpb24ob2JqZWN0SWRTdHIpIHsNCgkJCWlmICh1YS53Mykgew0KCQkJCXJldHVybiBnZXRPYmplY3RCeUlkKG9iamVjdElkU3RyKTsNCgkJCX0NCgkJfSwNCgkJDQoJCWVtYmVkU1dGOiBmdW5jdGlvbihzd2ZVcmxTdHIsIHJlcGxhY2VFbGVtSWRTdHIsIHdpZHRoU3RyLCBoZWlnaHRTdHIsIHN3ZlZlcnNpb25TdHIsIHhpU3dmVXJsU3RyLCBmbGFzaHZhcnNPYmosIHBhck9iaiwgYXR0T2JqLCBjYWxsYmFja0ZuKSB7DQoJCQl2YXIgY2FsbGJhY2tPYmogPSB7c3VjY2VzczpmYWxzZSwgaWQ6cmVwbGFjZUVsZW1JZFN0cn07DQoJCQlpZiAodWEudzMgJiYgISh1YS53ayAmJiB1YS53ayA8IDMxMikgJiYgc3dmVXJsU3RyICYmIHJlcGxhY2VFbGVtSWRTdHIgJiYgd2lkdGhTdHIgJiYgaGVpZ2h0U3RyICYmIHN3ZlZlcnNpb25TdHIpIHsNCgkJCQlzZXRWaXNpYmlsaXR5KHJlcGxhY2VFbGVtSWRTdHIsIGZhbHNlKTsNCgkJCQlhZGREb21Mb2FkRXZlbnQoZnVuY3Rpb24oKSB7DQoJCQkJCXdpZHRoU3RyICs9ICIiOyAvLyBhdXRvLWNvbnZlcnQgdG8gc3RyaW5nDQoJCQkJCWhlaWdodFN0ciArPSAiIjsNCgkJCQkJdmFyIGF0dCA9IHt9Ow0KCQkJCQlpZiAoYXR0T2JqICYmIHR5cGVvZiBhdHRPYmogPT09IE9CSkVDVCkgew0KCQkJCQkJZm9yICh2YXIgaSBpbiBhdHRPYmopIHsgLy8gY29weSBvYmplY3QgdG8gYXZvaWQgdGhlIHVzZSBvZiByZWZlcmVuY2VzLCBiZWNhdXNlIHdlYiBhdXRob3JzIG9mdGVuIHJldXNlIGF0dE9iaiBmb3IgbXVsdGlwbGUgU1dGcw0KCQkJCQkJCWF0dFtpXSA9IGF0dE9ialtpXTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlhdHQuZGF0YSA9IHN3ZlVybFN0cjsNCgkJCQkJYXR0LndpZHRoID0gd2lkdGhTdHI7DQoJCQkJCWF0dC5oZWlnaHQgPSBoZWlnaHRTdHI7DQoJCQkJCXZhciBwYXIgPSB7fTsgDQoJCQkJCWlmIChwYXJPYmogJiYgdHlwZW9mIHBhck9iaiA9PT0gT0JKRUNUKSB7DQoJCQkJCQlmb3IgKHZhciBqIGluIHBhck9iaikgeyAvLyBjb3B5IG9iamVjdCB0byBhdm9pZCB0aGUgdXNlIG9mIHJlZmVyZW5jZXMsIGJlY2F1c2Ugd2ViIGF1dGhvcnMgb2Z0ZW4gcmV1c2UgcGFyT2JqIGZvciBtdWx0aXBsZSBTV0ZzDQoJCQkJCQkJcGFyW2pdID0gcGFyT2JqW2pdOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCWlmIChmbGFzaHZhcnNPYmogJiYgdHlwZW9mIGZsYXNodmFyc09iaiA9PT0gT0JKRUNUKSB7DQoJCQkJCQlmb3IgKHZhciBrIGluIGZsYXNodmFyc09iaikgeyAvLyBjb3B5IG9iamVjdCB0byBhdm9pZCB0aGUgdXNlIG9mIHJlZmVyZW5jZXMsIGJlY2F1c2Ugd2ViIGF1dGhvcnMgb2Z0ZW4gcmV1c2UgZmxhc2h2YXJzT2JqIGZvciBtdWx0aXBsZSBTV0ZzDQoJCQkJCQkJaWYgKHR5cGVvZiBwYXIuZmxhc2h2YXJzICE9IFVOREVGKSB7DQoJCQkJCQkJCXBhci5mbGFzaHZhcnMgKz0gIiYiICsgayArICI9IiArIGZsYXNodmFyc09ialtrXTsNCgkJCQkJCQl9DQoJCQkJCQkJZWxzZSB7DQoJCQkJCQkJCXBhci5mbGFzaHZhcnMgPSBrICsgIj0iICsgZmxhc2h2YXJzT2JqW2tdOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlpZiAoaGFzUGxheWVyVmVyc2lvbihzd2ZWZXJzaW9uU3RyKSkgeyAvLyBjcmVhdGUgU1dGDQoJCQkJCQl2YXIgb2JqID0gY3JlYXRlU1dGKGF0dCwgcGFyLCByZXBsYWNlRWxlbUlkU3RyKTsNCgkJCQkJCWlmIChhdHQuaWQgPT0gcmVwbGFjZUVsZW1JZFN0cikgew0KCQkJCQkJCXNldFZpc2liaWxpdHkocmVwbGFjZUVsZW1JZFN0ciwgdHJ1ZSk7DQoJCQkJCQl9DQoJCQkJCQljYWxsYmFja09iai5zdWNjZXNzID0gdHJ1ZTsNCgkJCQkJCWNhbGxiYWNrT2JqLnJlZiA9IG9iajsNCgkJCQkJfQ0KCQkJCQllbHNlIGlmICh4aVN3ZlVybFN0ciAmJiBjYW5FeHByZXNzSW5zdGFsbCgpKSB7IC8vIHNob3cgQWRvYmUgRXhwcmVzcyBJbnN0YWxsDQoJCQkJCQlhdHQuZGF0YSA9IHhpU3dmVXJsU3RyOw0KCQkJCQkJc2hvd0V4cHJlc3NJbnN0YWxsKGF0dCwgcGFyLCByZXBsYWNlRWxlbUlkU3RyLCBjYWxsYmFja0ZuKTsNCgkJCQkJCXJldHVybjsNCgkJCQkJfQ0KCQkJCQllbHNlIHsgLy8gc2hvdyBhbHRlcm5hdGl2ZSBjb250ZW50DQoJCQkJCQlzZXRWaXNpYmlsaXR5KHJlcGxhY2VFbGVtSWRTdHIsIHRydWUpOw0KCQkJCQl9DQoJCQkJCWlmIChjYWxsYmFja0ZuKSB7IGNhbGxiYWNrRm4oY2FsbGJhY2tPYmopOyB9DQoJCQkJfSk7DQoJCQl9DQoJCQllbHNlIGlmIChjYWxsYmFja0ZuKSB7IGNhbGxiYWNrRm4oY2FsbGJhY2tPYmopOwl9DQoJCX0sDQoJCQ0KCQlzd2l0Y2hPZmZBdXRvSGlkZVNob3c6IGZ1bmN0aW9uKCkgew0KCQkJYXV0b0hpZGVTaG93ID0gZmFsc2U7DQoJCX0sDQoJCQ0KCQl1YTogdWEsDQoJCQ0KCQlnZXRGbGFzaFBsYXllclZlcnNpb246IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHsgbWFqb3I6dWEucHZbMF0sIG1pbm9yOnVhLnB2WzFdLCByZWxlYXNlOnVhLnB2WzJdIH07DQoJCX0sDQoJCQ0KCQloYXNGbGFzaFBsYXllclZlcnNpb246IGhhc1BsYXllclZlcnNpb24sDQoJCQ0KCQljcmVhdGVTV0Y6IGZ1bmN0aW9uKGF0dE9iaiwgcGFyT2JqLCByZXBsYWNlRWxlbUlkU3RyKSB7DQoJCQlpZiAodWEudzMpIHsNCgkJCQlyZXR1cm4gY3JlYXRlU1dGKGF0dE9iaiwgcGFyT2JqLCByZXBsYWNlRWxlbUlkU3RyKTsNCgkJCX0NCgkJCWVsc2Ugew0KCQkJCXJldHVybiB1bmRlZmluZWQ7DQoJCQl9DQoJCX0sDQoJCQ0KCQlzaG93RXhwcmVzc0luc3RhbGw6IGZ1bmN0aW9uKGF0dCwgcGFyLCByZXBsYWNlRWxlbUlkU3RyLCBjYWxsYmFja0ZuKSB7DQoJCQlpZiAodWEudzMgJiYgY2FuRXhwcmVzc0luc3RhbGwoKSkgew0KCQkJCXNob3dFeHByZXNzSW5zdGFsbChhdHQsIHBhciwgcmVwbGFjZUVsZW1JZFN0ciwgY2FsbGJhY2tGbik7DQoJCQl9DQoJCX0sDQoJCQ0KCQlyZW1vdmVTV0Y6IGZ1bmN0aW9uKG9iakVsZW1JZFN0cikgew0KCQkJaWYgKHVhLnczKSB7DQoJCQkJcmVtb3ZlU1dGKG9iakVsZW1JZFN0cik7DQoJCQl9DQoJCX0sDQoJCQ0KCQljcmVhdGVDU1M6IGZ1bmN0aW9uKHNlbFN0ciwgZGVjbFN0ciwgbWVkaWFTdHIsIG5ld1N0eWxlQm9vbGVhbikgew0KCQkJaWYgKHVhLnczKSB7DQoJCQkJY3JlYXRlQ1NTKHNlbFN0ciwgZGVjbFN0ciwgbWVkaWFTdHIsIG5ld1N0eWxlQm9vbGVhbik7DQoJCQl9DQoJCX0sDQoJCQ0KCQlhZGREb21Mb2FkRXZlbnQ6IGFkZERvbUxvYWRFdmVudCwNCgkJDQoJCWFkZExvYWRFdmVudDogYWRkTG9hZEV2ZW50LA0KCQkNCgkJZ2V0UXVlcnlQYXJhbVZhbHVlOiBmdW5jdGlvbihwYXJhbSkgew0KCQkJdmFyIHEgPSBkb2MubG9jYXRpb24uc2VhcmNoIHx8IGRvYy5sb2NhdGlvbi5oYXNoOw0KCQkJaWYgKHEpIHsNCgkJCQlpZiAoL1w/Ly50ZXN0KHEpKSB7IHEgPSBxLnNwbGl0KCI/IilbMV07IH0gLy8gc3RyaXAgcXVlc3Rpb24gbWFyaw0KCQkJCWlmIChwYXJhbSA9PSBudWxsKSB7DQoJCQkJCXJldHVybiB1cmxFbmNvZGVJZk5lY2Vzc2FyeShxKTsNCgkJCQl9DQoJCQkJdmFyIHBhaXJzID0gcS5zcGxpdCgiJiIpOw0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHsNCgkJCQkJaWYgKHBhaXJzW2ldLnN1YnN0cmluZygwLCBwYWlyc1tpXS5pbmRleE9mKCI9IikpID09IHBhcmFtKSB7DQoJCQkJCQlyZXR1cm4gdXJsRW5jb2RlSWZOZWNlc3NhcnkocGFpcnNbaV0uc3Vic3RyaW5nKChwYWlyc1tpXS5pbmRleE9mKCI9IikgKyAxKSkpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuICIiOw0KCQl9LA0KCQkNCgkJLy8gRm9yIGludGVybmFsIHVzYWdlIG9ubHkNCgkJZXhwcmVzc0luc3RhbGxDYWxsYmFjazogZnVuY3Rpb24oKSB7DQoJCQlpZiAoaXNFeHByZXNzSW5zdGFsbEFjdGl2ZSkgew0KCQkJCXZhciBvYmogPSBnZXRFbGVtZW50QnlJZChFWFBSRVNTX0lOU1RBTExfSUQpOw0KCQkJCWlmIChvYmogJiYgc3RvcmVkQWx0Q29udGVudCkgew0KCQkJCQlvYmoucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoc3RvcmVkQWx0Q29udGVudCwgb2JqKTsNCgkJCQkJaWYgKHN0b3JlZEFsdENvbnRlbnRJZCkgew0KCQkJCQkJc2V0VmlzaWJpbGl0eShzdG9yZWRBbHRDb250ZW50SWQsIHRydWUpOw0KCQkJCQkJaWYgKHVhLmllICYmIHVhLndpbikgeyBzdG9yZWRBbHRDb250ZW50LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOyB9DQoJCQkJCX0NCgkJCQkJaWYgKHN0b3JlZENhbGxiYWNrRm4pIHsgc3RvcmVkQ2FsbGJhY2tGbihzdG9yZWRDYWxsYmFja09iaik7IH0NCgkJCQl9DQoJCQkJaXNFeHByZXNzSW5zdGFsbEFjdGl2ZSA9IGZhbHNlOw0KCQkJfSANCgkJfQ0KCX07DQp9KCk7DQo=";
  
  static hetima.HetimaData createPlayerswf() {
    List<int> buffer = crypt.CryptoUtils.base64StringToBytes(playerswf);
    hetima.ArrayBuilder builder = new hetima.ArrayBuilder.fromList(buffer);
    return new hetima.HetimaBuilderToFile(builder);
  }


  static String previewFlvHtml(String path) {
    return 
"""<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><body>"""+
"""<object type="application/x-shockwave-flash" data="hetima.system.player.swf" width="100%" height="100%">"""+
"""<param name="FlashVars" value="flvaddr=${path}" />"""+
"""<param name="quality" value="high"/><param name="bgcolor" value="#ffffff"/>"""+
"""<param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="true" /></object></object></body></html>""";
  }
}
